<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>스마트 급수 시스템</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  #pumpControl { margin-top: 20px; }
  button { padding: 10px 20px; font-size: 16px; }
  #status { margin-top: 10px; }
</style>
</head>
<body>

<h1>스마트 급수 시스템</h1>

<p>현재 모드: <span id="modeDisplay">-</span></p>
<p>토양 습도: <span id="moistureDisplay">-</span></p>
<p>펌프 상태: <span id="pumpStateDisplay">-</span></p>

<div id="pumpControl" style="display:none;">
  <button id="pumpToggleBtn">펌프 ON</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  // Firebase 구성
  const firebaseConfig = {
    apiKey: "AIzaSyBiL0ye_VT5UKozsKwdt__orQQw6VCARm8",
    authDomain: "exwater01-default-rtdb.asia-southeast1.firebasedatabase.app",
    databaseURL: "https://exwater01-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "exwater01-default-rtdb",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const modeDisplay = document.getElementById('modeDisplay');
  const moistureDisplay = document.getElementById('moistureDisplay');
  const pumpStateDisplay = document.getElementById('pumpStateDisplay');
  const pumpControlDiv = document.getElementById('pumpControl');
  const pumpToggleBtn = document.getElementById('pumpToggleBtn');

  let currentMode = "";
  let pumpState = false;

  // 펌프 상태 토글 함수
  function togglePump() {
    const newPumpState = !pumpState;
    db.ref('/PUMP/STATE').set(newPumpState)
      .then(() => {
        console.log('펌프 상태 변경됨:', newPumpState);
      })
      .catch((error) => {
        console.error('펌프 상태 변경 실패:', error);
      });
  }

  pumpToggleBtn.addEventListener('click', togglePump);

  // Firebase 실시간 감시
  db.ref('/PUMP/mode').on('value', (snapshot) => {
    const mode = snapshot.val();
    if (mode) {
      currentMode = mode;
      modeDisplay.textContent = mode;

      // 자동 모드면 버튼 숨기기, 수동 모드면 보이기
      if (mode === 'manual') {
        pumpControlDiv.style.display = 'block';
      } else {
        pumpControlDiv.style.display = 'none';
      }
    }
  });

  db.ref('/sensor/moisture').on('value', (snapshot) => {
    const moisture = snapshot.val();
    if (moisture !== null) {
      moistureDisplay.textContent = moisture;
    }
  });

  db.ref('/PUMP/STATE').on('value', (snapshot) => {
    pumpState = snapshot.val();
    pumpStateDisplay.textContent = pumpState ? 'ON' : 'OFF';
    pumpToggleBtn.textContent = pumpState ? '펌프 OFF' : '펌프 ON';
  });

</script>

</body>
</html>
