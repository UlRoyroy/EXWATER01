<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>스마트 급수 시스템</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: #f1f1f1;
      padding: 2rem;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 1.5rem;
      margin: 1rem auto;
      max-width: 400px;
    }
    h2 { margin-bottom: 0.5rem; }
    .sensor { font-size: 1.2rem; margin: 0.3rem 0; }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      margin-top: 1rem;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>

  <div class="card">
    <h2>🌱 스마트 급수 시스템</h2>
    <div class="sensor" id="temp">온도: -- ℃</div>
    <div class="sensor" id="humi">습도: -- %</div>
    <div class="sensor" id="moist">토양 수분: --</div>
    <div class="sensor" id="state">펌프 상태: --</div>
    <div class="sensor" id="mode">모드: --</div>
    <div class="sensor" id="runtime">가동시간: --초</div>
    <div class="sensor" id="time">업데이트: --</div>
    <button onclick="toggleMode()">모드 전환</button>
  </div>

  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyAeHP9-GL_uC4c7i9d1R0QCgd99NdzKWD0",
      authDomain: "exwater01.firebaseapp.com",
      databaseURL: "https://exwater01-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "exwater01",
      storageBucket: "exwater01.appspot.com",
      messagingSenderId: "YOUR_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const el = id => document.getElementById(id);

    function updateUI(snapshot) {
      const s = snapshot.val();
      if (!s) return;

      el("temp").innerText = `온도: ${s.sensor?.temperature ?? '--'} ℃`;
      el("humi").innerText = `습도: ${s.sensor?.humidity ?? '--'} %`;
      el("moist").innerText = `토양 수분: ${s.sensor?.moisture ?? '--'}`;
      el("state").innerText = `펌프 상태: ${s.PUMP?.STATE ? 'ON 💧' : 'OFF'}`;
      el("mode").innerText = `모드: ${s.PUMP?.MODE ?? '--'}`;
      el("runtime").innerText = `가동시간: ${s.PUMP?.runtime ?? '--'}초`;
      el("time").innerText = `업데이트: ${s.PUMP?.time ?? '--'}`;
    }

    db.ref().on("value", updateUI);

    function toggleMode() {
      db.ref("/PUMP/MODE").once("value").then(snapshot => {
        const current = snapshot.val();
        const next = current === "auto" ? "manual" : "auto";
        db.ref("/PUMP/MODE").set(next);
      });
    }
  </script>

</body>
</html>
